<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Begin</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    background: #000; /* BLACK BACKGROUND */
    font-family: "Press Start 2P", monospace;
  }

  .center {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    width: 320px;
    height: 320px;
    pointer-events: none;
  }

  .cookie {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%) scale(1);
    background-size: cover;
    background-position: center;
    display: none;
    opacity: 0;
    pointer-events: auto;
    transition: opacity 250ms ease, transform 160ms ease;
    z-index: 30;
    image-rendering: pixelated;
  }

  #cookie1 { width: 260px; height: 260px; }
  #cookie2 { width: 320px; height: 320px; }

  .cookie.visible {
    display: block;
    opacity: 1;
  }

  /* CRT OVERLAY WHEN COOKIE2 APPEARS */
  #crtOverlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,0.3) 0px,
      rgba(0,0,0,0.3) 2px,
      rgba(0,0,0,0.35) 2px,
      rgba(0,0,0,0.35) 3px
    );
    opacity: 0;
    mix-blend-mode: multiply;
    transition: opacity 800ms ease;
    z-index: 200;
  }

  /* GLITCH FLASHES */
  .flash {
    position: fixed;
    inset: 0;
    background: #fff;
    opacity: 0;
    pointer-events: none;
    z-index: 500;
  }

  #flash2 { background: #0f0; }
</style>
</head>
<body>

<div class="center">

  <!-- cookie 1 -->
  <div id="cookie1" class="cookie" style="background-image:url('assets/cookie1.png');"></div>

  <!-- cookie 2 -->
  <div id="cookie2" class="cookie" style="background-image:url('assets/cookie2.png');"></div>

</div>

<div id="crtOverlay"></div>
<div id="flash1" class="flash"></div>
<div id="flash2" class="flash"></div>

<audio id="bgm" src="poem panic.mp3" preload="auto"></audio>

<script>
/* COOKIES */
const cookie1 = document.getElementById("cookie1");
const cookie2 = document.getElementById("cookie2");

const crt = document.getElementById("crtOverlay");
const flash1 = document.getElementById("flash1");
const flash2 = document.getElementById("flash2");
const bgm = document.getElementById("bgm");

let cookie1Clicks = 0;
let cookie2Clicks = 0;

/* CLICK ANIMATION */
function cookiePing(el){
  el.classList.remove("ping");
  void el.offsetWidth;
  el.classList.add("ping");
}

/* AUTO-SHOW COOKIE1 ON LOAD */
window.onload = () => {
  cookie1.style.display = "block";
  requestAnimationFrame(()=> cookie1.style.opacity = "1");
  bgm.volume = 0.4;
  bgm.play().catch(()=>{});
};

/* COOKIE 1 → after 5 clicks → cookie2 */
cookie1.addEventListener("click", () => {
  cookiePing(cookie1);
  cookie1Clicks++;

  if(cookie1Clicks >= 5){
    cookie1.style.opacity = "0";
    setTimeout(()=>{
      cookie1.style.display = "none";

      cookie2.classList.add("visible");

      /* darken + crt + glitch flashes */
      setTimeout(()=> { crt.style.opacity = 1; }, 200);

      setTimeout(()=>{
        flash1.style.opacity = 1;
        setTimeout(()=> flash1.style.opacity = 0, 150);
      }, 400);

      setTimeout(()=>{
        flash2.style.opacity = 1;
        setTimeout(()=> flash2.style.opacity = 0, 120);
      }, 900);

      startCookie2Loading();

    }, 250);
  }
});

/* COOKIE2 LOADING BAR + STUTTERS */
let loadProgress = 0;
let loadingActive = false;

function startCookie2Loading(){
  if(loadingActive) return;
  loadingActive = true;

  const interval = setInterval(()=>{
    loadProgress += Math.random() * 8; // variable speed

    /* RANDOM STUTTER */
    if(Math.random() < 0.15){
      setTimeout(()=>{}, 300); // half-second freeze
      return;
    }

    if(loadProgress >= 100){
      loadProgress = 100;
      clearInterval(interval);
    }

    cookie2.style.transform =
      `translate(-50%, -50%) scale(${1 + loadProgress/300})`;

  }, 120);
}

/* COOKIE 2 → jumpscare at 10 clicks */
cookie2.addEventListener("click", () => {
  cookiePing(cookie2);
  cookie2Clicks++;

  if(cookie2Clicks >= 10){
    // HUGE instant zoom jumpscare
    cookie2.style.transition = "transform 60ms linear";
    cookie2.style.transform = "translate(-50%, -50%) scale(10)";

    flash1.style.opacity = 1;
    setTimeout(()=> flash1.style.opacity = 0, 200);
  }
});
</script>

</body>
</html>
